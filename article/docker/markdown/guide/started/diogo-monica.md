# 기밀 데이터에 ENV 변수를 사용하면 안 되는 이유 [#](https://blog.diogomonica.com//2017/03/27/why-you-shouldnt-use-env-variables-for-secret-data/)

12요소 애플리케이션 매니페스토는 애플리케이션 구성을 ENV 변수로 전달할 것을 권장한다. 그러나 응용 프로그램에 암호, SSH 개인 키, TLS 인증서 또는 기타 중요한 데이터가 필요한 경우 구성과 함께 전달하면 안 된다.

![](https://blog.diogomonica.com/content/images/2017/03/Screenshot-2017-03-27-09.08.29.png)

환경 변수에 비밀 키를 저장하면 실수로 비밀 키가 노출되기 쉽다. 바로 이를 방지하고자 하는 것이다. 다음은 ENV 변수가 비밀에 적합하지 않은 몇 가지 이유이다:

- 프로세스에 암묵적으로 사용 가능한 환경임을 고려할 때, 액세스 및 콘텐츠가 노출되는 방식을 추적하는 것은 불가능하지는 않더라도 어렵다(`ps -ew <PID>`).
- 디버깅 또는 오류 보고를 위해 애플리케이션이 전체 환경을 파악하고 인쇄하는 것이 일반적이다. PagerDuty에 너무 많은 비밀이 유출되어 인프라에서 삭제할 수 있는 내부 프로세스가 잘 정비되어 있다.
- 환경 변수는 하위 프로세스로 전달되므로 의도하지 않은 액세스가 가능하다. 이것은 최소한의 특권의 원칙을 깨뜨린다. 애플리케이션의 일부로 타사 툴을 호출하여 어떤 작업을 수행한다고 상상해 보자. 갑자기 타사 툴이 환경에 액세스할 수 있게 되고, 이 툴이 환경에 어떤 영향을 미칠지 아무도 모른다.
- 애플리케이션이 충돌하면 나중에 디버깅할 수 있도록 환경 변수를 로그 파일에 저장하는 것이 일반적이다. 이것은 디스크의 일반 텍스트 비밀을 의미한다.
- ENV 변수에 비밀을 넣는 것은 부족 지식으로 빠르게 바뀐다. 특정 환경 변수의 민감한 특성을 인식하지 못하는 신규 엔지니어는 해당 변수를 적절하게/주의 깊게 처리하지 못할 것이다(하위 프로세스 등에 필터링).

전반적으로, ENV 변수의 비밀은 최소한의 놀라움의 원칙을 깨며, 나쁜 관행이며, 결국 비밀의 유출로 이어질 것이다.

# 환경 변수가 아니라면 무엇을 사용해야할까?

이전 직장에서 저는 정말 우아한 솔루션으로 이 문제를 해결하는 것을 도왔다: 키위즈. Docker에서는 한 걸음 더 나아가 Docker 자체에 유사한 솔루션을 직접 구축했다. 스웜을 사용하는 경우, 이제 기밀을 안전하게 관리할 수 있는 간단한 방법을 사용할 수 있다:

```
openssl rand -base64 32 | docker secret create secure-secret -
```

그리고 이것이 마지막이다. 이제 암호를 사용할 수 있다:

```
docker service create --secret="secure-secret" redis:alpine
```

그리고 `/run/secrets/secure-secrets/secure-secret` 아래에 생성되는 메모리 내 `tmps`에서 응용 프로그램이 비밀 내용을 읽도록 한다:

```
cat /run/secrets/secure-secret
eHwX8kV8sFt/y30WASgz8kimnKhUkCrt07XMrmewYr8=
```

Docker에 암호를 통합함으로써 다음 원칙을 따르는 암호 관리 솔루션을 제공할 수 있었다:

- 비밀은 항상 암호화되어 있다. 운송 중에도 정지 중에도 말이다.
- 비밀은 최종 응용 프로그램에 의해 사용될 때 의도치 않게 유출되기 어렵다.
- 비밀 접근은 최소 특권의 원칙을 고수한다.

사용하기 쉽고 기본적으로 안전한 비밀 배포 메커니즘을 갖는 것이 바로 개발자와 운영진이 비밀 관리 문제를 완전히 해결하기 위해 필요한 것이다.